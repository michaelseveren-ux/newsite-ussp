---
import type { AircraftImage } from '../types/aircraft';

interface Props {
  images: AircraftImage[];
  title: string;
}

const { images, title } = Astro.props;
---

<div class="aircraft-gallery" data-gallery>
  <!-- Main Image -->
  <div class="relative aspect-[16/10] overflow-hidden rounded-xl bg-gray-100 mb-4">
    <img
      id="gallery-main-image"
      src={images[0]?.url}
      alt={images[0]?.alt || title}
      class="w-full h-full object-cover"
    />

    <!-- Navigation Arrows (only if multiple images) -->
    {images.length > 1 && (
      <>
        <button
          type="button"
          class="gallery-prev absolute left-4 top-1/2 -translate-y-1/2 w-12 h-12 bg-white/90 hover:bg-white rounded-full shadow-lg flex items-center justify-center transition-all"
          aria-label="Previous image"
        >
          <svg class="w-6 h-6 text-primary-900" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
        </button>
        <button
          type="button"
          class="gallery-next absolute right-4 top-1/2 -translate-y-1/2 w-12 h-12 bg-white/90 hover:bg-white rounded-full shadow-lg flex items-center justify-center transition-all"
          aria-label="Next image"
        >
          <svg class="w-6 h-6 text-primary-900" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </button>
      </>
    )}

    <!-- Image Counter -->
    {images.length > 1 && (
      <div class="absolute bottom-4 right-4 px-3 py-1 bg-black/60 text-white text-sm rounded-full">
        <span id="gallery-current">1</span> / {images.length}
      </div>
    )}
  </div>

  <!-- Caption -->
  <p id="gallery-caption" class="text-center text-gray-600 mb-4 min-h-[1.5rem]">
    {images[0]?.caption || ''}
  </p>

  <!-- Thumbnails (only if multiple images) -->
  {images.length > 1 && (
    <div class="flex gap-3 overflow-x-auto pb-2">
      {images.map((image, index) => (
        <button
          type="button"
          class:list={[
            'gallery-thumb flex-shrink-0 w-24 h-18 rounded-lg overflow-hidden border-2 transition-all',
            index === 0 ? 'border-accent-500 ring-2 ring-accent-500/30' : 'border-transparent hover:border-gray-300',
          ]}
          data-index={index}
          data-url={image.url}
          data-alt={image.alt}
          data-caption={image.caption || ''}
          aria-label={`View image ${index + 1}`}
        >
          <img
            src={image.url}
            alt={image.alt}
            class="w-full h-full object-cover"
            loading="lazy"
          />
        </button>
      ))}
    </div>
  )}
</div>

<!-- Hidden data for JavaScript -->
<script
  id="gallery-data"
  type="application/json"
  set:html={JSON.stringify(images)}
/>

<script>
  // Gallery functionality
  const gallery = document.querySelector('[data-gallery]');
  if (gallery) {
    const mainImage = document.getElementById('gallery-main-image') as HTMLImageElement;
    const currentSpan = document.getElementById('gallery-current');
    const captionEl = document.getElementById('gallery-caption');
    const prevBtn = gallery.querySelector('.gallery-prev');
    const nextBtn = gallery.querySelector('.gallery-next');
    const thumbs = gallery.querySelectorAll('.gallery-thumb');

    const dataScript = document.getElementById('gallery-data');
    const images = dataScript ? JSON.parse(dataScript.textContent || '[]') : [];

    let currentIndex = 0;

    function updateGallery(index: number) {
      if (index < 0) index = images.length - 1;
      if (index >= images.length) index = 0;

      currentIndex = index;
      const image = images[index];

      if (mainImage && image) {
        mainImage.src = image.url;
        mainImage.alt = image.alt || '';
      }

      if (currentSpan) {
        currentSpan.textContent = String(index + 1);
      }

      if (captionEl) {
        captionEl.textContent = image?.caption || '';
      }

      // Update thumbnail active state
      thumbs.forEach((thumb, i) => {
        if (i === index) {
          thumb.classList.add('border-accent-500', 'ring-2', 'ring-accent-500/30');
          thumb.classList.remove('border-transparent');
        } else {
          thumb.classList.remove('border-accent-500', 'ring-2', 'ring-accent-500/30');
          thumb.classList.add('border-transparent');
        }
      });
    }

    // Arrow navigation
    prevBtn?.addEventListener('click', () => updateGallery(currentIndex - 1));
    nextBtn?.addEventListener('click', () => updateGallery(currentIndex + 1));

    // Thumbnail navigation
    thumbs.forEach((thumb) => {
      thumb.addEventListener('click', () => {
        const index = parseInt(thumb.getAttribute('data-index') || '0', 10);
        updateGallery(index);
      });
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') {
        updateGallery(currentIndex - 1);
      } else if (e.key === 'ArrowRight') {
        updateGallery(currentIndex + 1);
      }
    });
  }
</script>

<style>
  .gallery-thumb {
    aspect-ratio: 4 / 3;
  }
</style>
