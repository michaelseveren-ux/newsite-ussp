---
import IconMenu from './icons/IconMenu.astro';
import IconClose from './icons/IconClose.astro';

interface Props {
  transparent?: boolean;
}

const { transparent = true } = Astro.props;

const companyDropdown = {
  label: 'Company',
  items: [
    { href: '/about', label: 'About Us' },
    { href: '/services', label: 'How We Help' },
    { href: '/blog', label: 'Press & Videos' },
    { href: '/service-map', label: 'Service & Flight Training' },
  ],
};

const jabiruDropdown = {
  label: 'Jabiru',
  items: [
    { href: '/jabiru-aircraft/j170-m', label: 'J170-M' },
    { href: '/jabiru-aircraft/j430-m', label: 'J430-M' },
    { href: '/jabiru-aircraft/j432-m', label: 'J432-M' },
    { href: '/jabiru-aircraft', label: 'View All Models' },
  ],
};
---

<nav
  id="navbar"
  data-transparent={transparent}
  class:list={[
    'fixed top-0 left-0 right-0 z-50 transition-all duration-300',
    transparent ? 'bg-transparent' : 'bg-primary-900/95 backdrop-blur-sm',
  ]}
>
  <div class="container-custom">
    <div class="flex items-center justify-between h-20">
      <!-- Logo -->
      <a href="/" class="flex items-center space-x-2">
        <span class="text-2xl font-bold text-white">US Sport Planes</span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center space-x-8">
        <!-- Jabiru Dropdown -->
        <div class="relative group">
          <button
            type="button"
            class="flex items-center gap-1 text-white/90 hover:text-gold-400 font-medium transition-colors focus:outline-none"
            aria-expanded="false"
            aria-haspopup="true"
          >
            {jabiruDropdown.label}
            <svg class="w-4 h-4 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <!-- Dropdown Menu -->
          <div class="absolute left-0 top-full pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible group-focus-within:opacity-100 group-focus-within:visible transition-all duration-200">
            <div class="bg-primary-900/95 backdrop-blur-sm rounded-lg shadow-lg border border-white/10 py-2 min-w-[180px]">
              {jabiruDropdown.items.map((item, i) => (
                <>
                  {i === jabiruDropdown.items.length - 1 && (
                    <div class="border-t border-white/10 my-1" />
                  )}
                  <a
                    href={item.href}
                    class="block px-4 py-2 text-white/90 hover:text-gold-400 hover:bg-white/5 transition-colors"
                  >
                    {item.label}
                  </a>
                </>
              ))}
            </div>
          </div>
        </div>

        <a href="/aircraft-for-sale" class="text-white/90 hover:text-gold-400 font-medium transition-colors">
          Aircraft Inventory
        </a>

        <!-- Company Dropdown -->
        <div class="relative group">
          <button
            type="button"
            class="flex items-center gap-1 text-white/90 hover:text-gold-400 font-medium transition-colors focus:outline-none"
            aria-expanded="false"
            aria-haspopup="true"
          >
            {companyDropdown.label}
            <svg class="w-4 h-4 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div class="absolute left-0 top-full pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible group-focus-within:opacity-100 group-focus-within:visible transition-all duration-200">
            <div class="bg-primary-900/95 backdrop-blur-sm rounded-lg shadow-lg border border-white/10 py-2 min-w-[200px]">
              {companyDropdown.items.map((item) => (
                <a
                  href={item.href}
                  class="block px-4 py-2 text-white/90 hover:text-gold-400 hover:bg-white/5 transition-colors"
                >
                  {item.label}
                </a>
              ))}
            </div>
          </div>
        </div>

        <a href="/contact" class="btn-primary">
          Get in Touch
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-btn"
        type="button"
        class="md:hidden p-2 text-white"
        aria-label="Toggle mobile menu"
        aria-expanded="false"
      >
        <IconMenu class="w-6 h-6 block" id="menu-icon" />
        <IconClose class="w-6 h-6 hidden" id="close-icon" />
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div
    id="mobile-menu"
    class="md:hidden hidden bg-primary-900/95 backdrop-blur-sm border-t border-white/10"
  >
    <div class="container-custom py-4 space-y-4">
      <!-- Jabiru Section -->
      <div class="space-y-2">
        <span class="block text-white/60 font-medium text-sm uppercase tracking-wider">
          {jabiruDropdown.label}
        </span>
        {jabiruDropdown.items.map((item) => (
          <a
            href={item.href}
            class="block text-white/90 hover:text-gold-400 font-medium py-2 pl-4 transition-colors mobile-nav-link"
          >
            {item.label}
          </a>
        ))}
      </div>

      <!-- Divider -->
      <div class="border-t border-white/10"></div>

      <a href="/aircraft-for-sale" class="block text-white/90 hover:text-gold-400 font-medium py-2 transition-colors mobile-nav-link">
        Aircraft Inventory
      </a>

      <!-- Company Section -->
      <div class="border-t border-white/10"></div>
      <div class="space-y-2">
        <span class="block text-white/60 font-medium text-sm uppercase tracking-wider">
          {companyDropdown.label}
        </span>
        {companyDropdown.items.map((item) => (
          <a
            href={item.href}
            class="block text-white/90 hover:text-gold-400 font-medium py-2 pl-4 transition-colors mobile-nav-link"
          >
            {item.label}
          </a>
        ))}
      </div>
      <a href="/contact" class="btn-primary w-full text-center mt-4 mobile-nav-link">
        Get in Touch
      </a>
    </div>
  </div>
</nav>

<script>
  // Mobile menu toggle
  const menuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = document.getElementById('menu-icon');
  const closeIcon = document.getElementById('close-icon');
  const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');

  function toggleMenu() {
    const isOpen = mobileMenu?.classList.toggle('hidden');
    menuIcon?.classList.toggle('hidden');
    menuIcon?.classList.toggle('block');
    closeIcon?.classList.toggle('hidden');
    closeIcon?.classList.toggle('block');
    menuBtn?.setAttribute('aria-expanded', String(!isOpen));
  }

  menuBtn?.addEventListener('click', toggleMenu);

  // Close menu when clicking a link
  mobileNavLinks.forEach((link) => {
    link.addEventListener('click', () => {
      if (!mobileMenu?.classList.contains('hidden')) {
        toggleMenu();
      }
    });
  });

  // Navbar background on scroll (only when transparent mode is enabled)
  const navbar = document.getElementById('navbar');
  const isTransparentMode = navbar?.dataset.transparent === 'true';

  function updateNavbar() {
    if (!isTransparentMode) return; // Don't modify non-transparent navbars

    if (window.scrollY > 50) {
      navbar?.classList.remove('bg-transparent');
      navbar?.classList.add('bg-primary-900/95', 'backdrop-blur-sm');
    } else {
      navbar?.classList.add('bg-transparent');
      navbar?.classList.remove('bg-primary-900/95', 'backdrop-blur-sm');
    }
  }

  window.addEventListener('scroll', updateNavbar);
  updateNavbar();
</script>
