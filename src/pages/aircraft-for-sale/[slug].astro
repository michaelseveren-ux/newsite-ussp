---
import Layout from '../../layouts/Layout.astro';
import Navigation from '../../components/Navigation.astro';
import Footer from '../../components/Footer.astro';
import StatusBadge from '../../components/StatusBadge.astro';
import PriceDisplay from '../../components/PriceDisplay.astro';
import AircraftGallery from '../../components/AircraftGallery.astro';
import AircraftSpecs from '../../components/AircraftSpecs.astro';
import { getAllAircraft, getAircraftBySlug } from '../../data/aircraft';
import type { AircraftType } from '../../types/aircraft';

export async function getStaticPaths() {
  const aircraft = await getAllAircraft();
  return aircraft.map((plane) => ({
    params: { slug: plane.slug },
  }));
}

const { slug } = Astro.params;
const aircraft = await getAircraftBySlug(slug);

if (!aircraft) {
  return Astro.redirect('/aircraft-for-sale');
}

const typeLabels: Record<AircraftType, string> = {
  'light-sport': 'Light Sport',
  experimental: 'Experimental',
  ultralight: 'Ultralight',
  amphibious: 'Amphibious',
  gyroplane: 'Gyroplane',
};
---

<Layout
  title={`${aircraft.title} | US Sport Planes`}
  description={aircraft.shortDescription}
>
  <Navigation transparent={false} />

  <!-- Breadcrumb -->
  <section class="pt-24 pb-4 bg-gray-50 border-b border-gray-200">
    <div class="container-custom">
      <nav class="flex items-center text-sm text-gray-500">
        <a href="/" class="hover:text-primary-900 transition-colors">Home</a>
        <svg class="w-4 h-4 mx-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
        <a href="/aircraft-for-sale" class="hover:text-primary-900 transition-colors">Aircraft Inventory</a>
        <svg class="w-4 h-4 mx-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
        <span class="text-primary-900 font-medium">{aircraft.title}</span>
      </nav>
    </div>
  </section>

  <!-- Main Content -->
  <section class="py-8 bg-gray-50">
    <div class="container-custom">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Left Column: Gallery and Details -->
        <div class="lg:col-span-2 space-y-8">
          <!-- Gallery -->
          <div class="bg-white rounded-xl shadow-md p-6">
            <AircraftGallery images={aircraft.images} title={aircraft.title} />
          </div>

          <!-- Description -->
          <div class="bg-white rounded-xl shadow-md p-6">
            <h2 class="text-2xl font-bold text-primary-900 mb-4">Description</h2>
            <div class="prose prose-gray max-w-none">
              {aircraft.fullDescription.split('\n\n').map((paragraph) => (
                <p class="text-gray-700 mb-4 last:mb-0">{paragraph}</p>
              ))}
            </div>
          </div>

          <!-- Features -->
          {aircraft.features.length > 0 && (
            <div class="bg-white rounded-xl shadow-md p-6">
              <h2 class="text-2xl font-bold text-primary-900 mb-4">Features & Equipment</h2>
              <ul class="grid grid-cols-1 md:grid-cols-2 gap-3">
                {aircraft.features.map((feature) => (
                  <li class="flex items-start gap-2">
                    <svg class="w-5 h-5 text-accent-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    <span class="text-gray-700">{feature}</span>
                  </li>
                ))}
              </ul>
            </div>
          )}

          <!-- Specifications -->
          <div class="bg-white rounded-xl shadow-md p-6">
            <h2 class="text-2xl font-bold text-primary-900 mb-6">Specifications</h2>
            <AircraftSpecs
              specs={aircraft.specs}
              totalTime={aircraft.totalTime}
              engineTime={aircraft.engineTime}
              propTime={aircraft.propTime}
            />
          </div>

          <!-- History -->
          {aircraft.history && (
            <div class="bg-white rounded-xl shadow-md p-6">
              <h2 class="text-2xl font-bold text-primary-900 mb-4">History & Maintenance</h2>
              <p class="text-gray-700">{aircraft.history}</p>
            </div>
          )}
        </div>

        <!-- Right Column: Summary Card -->
        <div class="lg:col-span-1">
          <div class="bg-white rounded-xl shadow-md p-6 sticky top-24">
            <!-- Status -->
            <div class="mb-4">
              <StatusBadge status={aircraft.status} size="md" />
            </div>

            <!-- Title -->
            <h1 class="text-2xl font-bold text-primary-900 mb-2">
              {aircraft.title}
            </h1>

            <!-- Type -->
            <p class="text-gray-600 mb-4">
              {typeLabels[aircraft.type]}
            </p>

            <!-- Price -->
            <div class="mb-6 pb-6 border-b border-gray-200">
              <PriceDisplay price={aircraft.price} size="lg" showLabel />
            </div>

            <!-- Quick Specs -->
            <div class="space-y-3 mb-6 pb-6 border-b border-gray-200">
              <div class="flex justify-between">
                <span class="text-gray-600">Year</span>
                <span class="font-medium text-primary-900">{aircraft.year}</span>
              </div>
              {aircraft.registration && (
                <div class="flex justify-between">
                  <span class="text-gray-600">Registration</span>
                  <span class="font-medium text-primary-900">{aircraft.registration}</span>
                </div>
              )}
              {aircraft.totalTime && (
                <div class="flex justify-between">
                  <span class="text-gray-600">Total Time</span>
                  <span class="font-medium text-primary-900">{aircraft.totalTime.toLocaleString()} hrs</span>
                </div>
              )}
              {aircraft.specs.engine && (
                <div class="flex justify-between">
                  <span class="text-gray-600">Engine</span>
                  <span class="font-medium text-primary-900">{aircraft.specs.engine}</span>
                </div>
              )}
              {aircraft.specs.cruiseSpeed && (
                <div class="flex justify-between">
                  <span class="text-gray-600">Cruise Speed</span>
                  <span class="font-medium text-primary-900">{aircraft.specs.cruiseSpeed}</span>
                </div>
              )}
            </div>

            <!-- CTA Buttons -->
            <div class="space-y-3">
              <a
                href={`/contact?aircraft=${encodeURIComponent(aircraft.title)}`}
                class="btn-primary w-full text-center"
              >
                Inquire About This Aircraft
              </a>
              <a
                href="tel:+1234567890"
                class="btn-outline w-full text-center"
              >
                Call (123) 456-7890
              </a>
            </div>

            <!-- Share -->
            <div class="mt-6 pt-6 border-t border-gray-200">
              <p class="text-sm text-gray-500 mb-2">Share this aircraft:</p>
              <div class="flex gap-2">
                <button
                  type="button"
                  class="p-2 text-gray-400 hover:text-primary-900 transition-colors"
                  onclick={`navigator.clipboard.writeText(window.location.href); alert('Link copied!')`}
                  aria-label="Copy link"
                >
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Back to Inventory -->
  <section class="py-8 bg-white border-t border-gray-200">
    <div class="container-custom">
      <a
        href="/aircraft-for-sale"
        class="inline-flex items-center gap-2 text-primary-900 hover:text-accent-600 font-medium transition-colors"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        Back to All Aircraft
      </a>
    </div>
  </section>

  <Footer />
</Layout>
